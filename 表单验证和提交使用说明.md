# 表单验证和提交使用说明

## 功能概述

已完成以下功能：

1. ✅ 移除了FormPreview中的固定操作按钮
2. ✅ 提交和重置功能通过配置的按钮实现
3. ✅ 添加了简化的验证功能（必填 + 自定义JavaScript验证）
4. ✅ 提交时自动传递表单数据（JSON格式）和表单ID

## 一、配置输入控件的验证

在编辑控件时，可以在"校验配置"面板中设置：

### 1. 必填项
- 勾选"必填项"复选框
- 设置错误提示信息，例如："用户名不能为空"

### 2. 自定义验证函数
编写JavaScript代码进行自定义验证，例如：

```javascript
// 验证密码长度
if (value.length < 6) {
    formAPI.showMessage('密码长度不能少于6位', 'error');
    return false;
}
return true;
```

```javascript
// 验证两次密码是否一致
var password = getControlValue('password');
if (value !== password) {
    formAPI.showMessage('两次密码输入不一致', 'error');
    return false;
}
return true;
```

**可用变量：**
- `value` - 当前控件的值
- `formAPI` - 表单API对象
- `getControlValue(key)` - 获取其他控件的值
- `showMessage(msg, type)` - 显示消息

## 二、配置提交按钮

### 1. 创建按钮控件
- 类型选择：Button
- 设置标签：如"提交"

### 2. 设置按钮动作
在"按钮动作"面板中：
- 选择"提交"类型
- 提交按钮会自动执行所有验证，验证通过后才执行点击事件

### 3. 编写提交函数
在"事件配置"面板的"点击事件"中编写提交代码：

```javascript
// 示例1：提交到数据库
var data = {
    formId: formId,           // 表单ID
    formData: formData        // 表单数据（JSON格式，包含所有控件的key和value）
};

try {
    // 提交到dynamicFormData表
    MySqlHelper.insert("dynamicFormData", data);
    showMessage("提交成功！", "success");
} catch(e) {
    showMessage("提交失败: " + e, "error");
}
```

```javascript
// 示例2：提交到指定数据库表
var submitData = {
    username: getControlValue('username'),
    email: getControlValue('email'),
    age: getControlValue('age'),
    formId: formId
};

try {
    MySqlHelper.insert("users", submitData);
    showMessage("用户注册成功！", "success");
} catch(e) {
    showMessage("注册失败: " + e, "error");
}
```

**可用变量：**
- `formId` - 表单ID（从dynamicList传入的记录ID）
- `formData` - 表单数据对象，格式：`{key1: value1, key2: value2, ...}`
- `getAllValues()` - 获取所有控件的值
- `formAPI` - 完整的表单API

## 三、配置重置按钮

### 1. 创建按钮控件
- 类型选择：Button
- 设置标签：如"重置"

### 2. 设置按钮动作
在"按钮动作"面板中：
- 选择"重置"类型
- 重置按钮会自动清空所有表单控件的值

### 3. 编写重置后的处理（可选）
在"事件配置"面板的"点击事件"中：

```javascript
// 重置后的处理
showMessage("表单已重置", "info");
```

## 四、完整示例

### 用户注册表单配置

**1. 用户名输入框**
- 标识：username
- 标签：用户名
- 必填：✓
- 错误提示：用户名不能为空
- 验证函数：
```javascript
if (value.length < 3) {
    formAPI.showMessage('用户名长度不能少于3位', 'error');
    return false;
}
return true;
```

**2. 密码输入框**
- 标识：password
- 标签：密码
- 类型：password
- 必填：✓
- 错误提示：密码不能为空
- 验证函数：
```javascript
if (value.length < 6) {
    formAPI.showMessage('密码长度不能少于6位', 'error');
    return false;
}
return true;
```

**3. 确认密码输入框**
- 标识：confirmPassword
- 标签：确认密码
- 类型：password
- 必填：✓
- 验证函数：
```javascript
var password = getControlValue('password');
if (value !== password) {
    formAPI.showMessage('两次密码输入不一致', 'error');
    return false;
}
return true;
```

**4. 邮箱输入框**
- 标识：email
- 标签：邮箱
- 必填：✓
- 验证函数：
```javascript
return validateEmail(value);
```

**5. 提交按钮**
- 标签：注册
- 按钮动作：提交
- 点击事件：
```javascript
var submitData = {
    formId: formId,
    username: getControlValue('username'),
    password: getControlValue('password'),
    email: getControlValue('email'),
    createTime: new Date().toISOString()
};

try {
    MySqlHelper.insert("users", submitData);
    showMessage("注册成功！", "success");
} catch(e) {
    showMessage("注册失败: " + e, "error");
}
```

**6. 重置按钮**
- 标签：重置
- 按钮动作：重置
- 点击事件：
```javascript
showMessage("表单已重置", "info");
```

## 五、验证流程

### 失去焦点时自动验证
当用户在输入框输入完成并失去焦点时：
1. 自动执行该控件的验证函数
2. 如果验证失败：
   - 显示错误提示消息
   - 标签文字变红
3. 如果验证成功：
   - 标签恢复原色

### 提交时验证所有控件
当用户点击提交按钮时：
1. 自动执行所有控件的验证
2. 执行自定义验证函数
3. 如果有验证失败：
   - 所有验证失败的控件标签变红
   - 显示错误汇总信息
   - 让第一个错误的控件获得焦点
   - 不执行提交函数
4. 如果所有验证通过：
   - 所有标签恢复原色
   - 执行按钮的点击事件（提交函数）

## 六、使用函数帮助对话框

在编写验证函数或提交函数时，可以点击"编写函数"按钮打开函数帮助对话框。

### 对话框功能：
1. **左侧函数列表**：显示所有可用的API函数和示例代码
2. **右侧代码编辑区**：编写JavaScript代码
3. **点击函数按钮**：自动在光标处插入示例代码

### 函数分类：
- **基础变量**：formId、formData、value等
- **表单API函数**：showMessage、validateAll、getAllValues等
- **验证函数**：validateEmail、validatePhone、validateNumber等
- **控件操作函数**：setControlValue、enableControl、disableControl等
- **控件样式函数**：setControlColor、hideControl、showControl等
- **高级验证函数**：validateIdCard、validateChinese等
- **数据库操作**：MySqlHelper.insert、MySqlHelper.select等
- **完整示例**：提交按钮完整示例（验证+提交）

## 七、可用的FormAPI方法

在验证函数和提交函数中可以使用：

### 基础变量
- `formId` - 表单ID（从dynamicList传入）
- `formData` - 表单数据对象（JSON格式）
- `value` - 当前控件的值（验证函数中）
- `formAPI` - FormAPI对象

### 表单操作
- `getAllValues()` - 获取所有控件的值
- `validateAll()` - 验证所有控件
- `resetForm()` - 重置整个表单

### 控件操作
- `getControlValue(key)` - 获取控件值
- `setControlValue(key, value)` - 设置控件值
- `enableControl(key)` - 启用控件
- `disableControl(key)` - 禁用控件
- `showControl(key)` - 显示控件
- `hideControl(key)` - 隐藏控件
- `focusControl(key)` - 让控件获得焦点
- `resetControl(key)` - 重置指定控件

### 消息提示
- `showMessage(msg, type)` - 显示消息（type: "info", "success", "error", "warning"）

### 验证函数
- `validateEmail(value)` - 验证邮箱
- `validatePhone(value)` - 验证手机号
- `validateIdCard(value)` - 验证身份证
- `validateChinese(value)` - 验证中文
- `validateNumber(value, min, max)` - 验证数字范围
- `validateRegex(value, pattern, errorMsg)` - 正则验证

### 数据库操作
- `MySqlHelper.insert(table, data)` - 插入数据
- `MySqlHelper.select(table, columns, where)` - 查询数据
- `MySqlHelper.update(table, data, where)` - 更新数据
- `MySqlHelper.remove(table, where)` - 删除数据
