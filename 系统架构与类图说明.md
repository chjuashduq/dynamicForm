# 动态表单系统架构与类图说明

## 目录
1. [系统整体架构](#系统整体架构)
2. [核心类图](#核心类图)
3. [数据流转图](#数据流转图)
4. [组件交互时序图](#组件交互时序图)
5. [设计模式应用](#设计模式应用)

---

## 系统整体架构

### MVC 三层架构

系统采用 **MVC（Model-View-Controller）** 架构模式，实现了视图、控制和数据的分离：

```
┌──────────────────────────────────────────────────────────────────┐
│                          View Layer (视图层)                       │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐   │
│  │ ConfigEditor │  │ FormPreview  │  │ ControlEditDialog    │   │
│  │ (配置编辑器)  │  │ (表单预览)    │  │ (控件编辑对话框)      │   │
│  └──────────────┘  └──────────────┘  └──────────────────────┘   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐   │
│  │ DynamicList  │  │ DataRecordList│ │ FunctionHelpDialog   │   │
│  │ (表单列表)    │  │ (数据记录列表) │  │ (函数帮助对话框)      │   │
│  └──────────────┘  └──────────────┘  └──────────────────────┘   │
└────────────────────────────┬─────────────────────────────────────┘
                             │
┌────────────────────────────▼─────────────────────────────────────┐
│                     Controller Layer (控制层)                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐   │
│  │ConfigManager │  │ControlFactory│  │ ScriptEngine         │   │
│  │(配置管理器)   │  │(控件工厂)     │  │(脚本执行引擎)         │   │
│  └──────────────┘  └──────────────┘  └──────────────────────┘   │
│  ┌──────────────┐  ┌──────────────┐                             │
│  │ TypeManager  │  │MessageManager│                             │
│  │(类型管理器)   │  │(消息管理器)   │                             │
│  └──────────────┘  └──────────────┘                             │
└────────────────────────────┬─────────────────────────────────────┘
                             │
┌────────────────────────────▼─────────────────────────────────────┐
│                       Model Layer (模型层)                         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐   │
│  │   FormAPI    │  │  MySqlHelper │  │   JSON Config        │   │
│  │ (表单API)     │  │ (数据库助手)  │  │  (JSON配置)          │   │
│  └──────────────┘  └──────────────┘  └──────────────────────┘   │
│  ┌──────────────┐  ┌──────────────┐                             │
│  │   AppStyles  │  │  Components  │                             │
│  │  (样式配置)   │  │  (UI组件库)   │                             │
│  └──────────────┘  └──────────────┘                             │
└──────────────────────────────────────────────────────────────────┘
```

### 各层职责说明

#### View Layer (视图层)
负责用户界面的展示和用户交互：

- **ConfigEditor**：表单配置编辑器，提供可视化的表单设计界面
- **FormPreview**：表单预览和渲染，根据配置动态生成表单
- **ControlEditDialog**：控件编辑对话框，配置单个控件的属性
- **DynamicList**：表单列表，显示所有已创建的表单
- **DataRecordList**：数据记录列表，显示表单提交的数据
- **FunctionHelpDialog**：函数帮助对话框，辅助编写事件函数

#### Controller Layer (控制层)
负责业务逻辑处理和数据流转：

- **ConfigManager**：配置管理器，管理表单配置的增删改查
- **ControlFactory**：控件工厂，根据配置动态创建控件实例
- **ScriptEngine**：脚本执行引擎，执行用户自定义的 JavaScript 代码
- **TypeManager**：类型管理器，管理控件类型定义
- **MessageManager**：消息管理器，统一管理消息提示

#### Model Layer (模型层)
负责数据存储和业务规则：

- **FormAPI**：表单操作 API，提供统一的表单操作接口
- **MySqlHelper**：数据库助手，封装数据库操作
- **JSON Config**：JSON 配置，存储表单配置数据
- **AppStyles**：样式配置，统一管理界面样式
- **Components**：UI 组件库，提供美化的基础组件

---

## 核心类图

### 完整类图

```
┌─────────────────────────────────────────────────────────────────┐
│                         ConfigEditor                             │
├─────────────────────────────────────────────────────────────────┤
│ - dynamicNameText: string                                        │
│ - stackViewRef: Object                                           │
│ - loaderInstanceRef: Object                                      │
│ - configManager: ConfigManager                                   │
├─────────────────────────────────────────────────────────────────┤
│ + initConfigEditor(name, config): void                           │
│ + connectGridPreviewSignals(): void                              │
└────────────┬────────────────────────────────────────────────────┘
             │ 包含
             ▼
┌─────────────────────────────────────────────────────────────────┐
│                        ConfigManager                             │
├─────────────────────────────────────────────────────────────────┤
│ - currentConfig: Object                                          │
├─────────────────────────────────────────────────────────────────┤
│ + addControl(type): void                                         │
│ + updateControl(index, config): void                             │
│ + removeControlAtPosition(row, col): void                        │
│ + exportConfig(): string                                         │
│ + resetConfig(): void                                            │
│ + initializeFromJson(json): void                                 │
│ + getControlIndex(control): number                               │
│ signal internalConfigChanged(config)                             │
└─────────────────────────────────────────────────────────────────┘

