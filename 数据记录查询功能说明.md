# 数据记录查询功能说明

## ✅ 已完成的功能

### 1. 增强输入框边框可见性
**修改：**
- 边框颜色从 `#e2e8f0` 改为 `#cbd5e0`（更深）
- 边框宽度从 `1px` 改为 `2px`
- 聚焦时边框宽度保持 `2px`，颜色变为紫色

**效果：**
- ✅ 输入框边框更清晰可见
- ✅ 聚焦状态更明显
- ✅ 整体视觉效果更好

### 2. 数据记录查询功能
**新增文件：**
- `qml/dynamic/dataRecordList.qml` - 数据记录列表页面

**功能特性：**
- ✅ 查询指定表单的所有数据记录
- ✅ 显示记录ID、数据内容、创建时间
- ✅ 提供查看、编辑、删除操作
- ✅ 支持新增记录
- ✅ 空状态提示
- ✅ 删除确认对话框
- ✅ 删除后自动刷新列表

## 📊 数据记录列表页面

### 页面结构
```
┌─────────────────────────────────────────────┐
│ [返回] 表单名称 - 数据记录    [新增记录]    │
├─────────────────────────────────────────────┤
│ ID │ 数据内容 │ 创建时间 │ 操作           │
├────┼──────────┼──────────┼────────────────┤
│ 1  │ {...}    │ 2024-... │ 查看 编辑 删除 │
│ 2  │ {...}    │ 2024-... │ 查看 编辑 删除 │
└─────────────────────────────────────────────┘
```

### 列说明
1. **ID** - 记录的唯一标识（8%宽度）
2. **数据内容** - JSON格式的表单数据（50%宽度）
3. **创建时间** - 记录创建时间（20%宽度）
4. **操作** - 查看、编辑、删除按钮（22%宽度）

### 操作按钮
- **查看** - 弹出对话框显示完整的数据内容
- **编辑** - 跳转到表单编辑页面（开发中）
- **删除** - 删除记录（有确认提示）

## 🔄 页面流程

### 查询记录流程
```
dynamicList（表单列表）
    ↓ 点击"查询"按钮
dataRecordList（数据记录列表）
    ↓ 点击"新增记录"
FormPreview（表单填写）
    ↓ 提交数据
返回 dataRecordList（自动刷新）
```

### 数据流
1. 用户在 dynamicList 点击"查询"按钮
2. 传递 formId、formName、formConfig 到 dataRecordList
3. dataRecordList 查询 dynamicData 表
4. 显示所有 dynamicId = formId 的记录

## 💾 数据库查询

### 查询语句
```javascript
var where = "dynamicId=" + formId;
var data = MySqlHelper.select("dynamicData", [], where);
```

### 数据表结构
```
dynamicData 表：
- id: 记录ID（主键）
- dynamicId: 表单ID（外键，关联 dynamicForm.id）
- data: JSON格式的表单数据
- createTime: 创建时间
```

### 删除记录
```javascript
var where = "id=" + recordId;
MySqlHelper.remove("dynamicData", where);
```

## 🎨 界面特性

### 美化样式
- ✅ 紫色主题表头
- ✅ 白色卡片样式数据行
- ✅ 统一的间距和圆角
- ✅ 使用 StyledButton 组件
- ✅ 响应式布局

### 空状态
当没有数据记录时，显示：
- 提示文字："暂无数据记录"
- 操作按钮："新增第一条记录"

### 交互反馈
- 删除前弹出确认对话框
- 删除成功显示 Toast 提示
- 删除失败显示错误提示
- 删除后自动刷新列表

## 📝 使用方法

### 1. 查询记录
1. 在表单列表页面，找到要查询的表单
2. 点击该表单行的"查询"按钮
3. 进入数据记录列表页面

### 2. 新增记录
1. 在数据记录列表页面，点击"新增记录"按钮
2. 进入表单填写页面
3. 填写表单并提交
4. 返回数据记录列表（自动刷新）

### 3. 查看记录
1. 在数据记录列表中，点击某条记录的"查看"按钮
2. 弹出对话框显示完整的数据内容（JSON格式）

### 4. 删除记录
1. 在数据记录列表中，点击某条记录的"删除"按钮
2. 确认删除操作
3. 记录被删除，列表自动刷新

## 🔧 技术实现

### Loader 管理
在 main.qml 中添加了 dataRecordListLoader：
```qml
Loader {
    id: dataRecordListLoader
    source: "dynamic/dataRecordList.qml"
    asynchronous: true
    active: true
    visible: false
}
```

### 页面初始化
```javascript
function initPage(id, name, config) {
    formId = id;
    formName = name;
    formConfig = JSON.parse(config);
    loadData();
}
```

### 数据加载
```javascript
function loadData() {
    try {
        var where = "dynamicId=" + formId;
        var data = MySqlHelper.select("dynamicData", [], where);
        dataRecordModel.clear();
        
        for (var i = 0; i < data.length; i++) {
            dataRecordModel.append({
                id: data[i].id,
                dynamicId: data[i].dynamicId,
                data: data[i].data || "{}",
                createTime: data[i].createTime || ""
            });
        }
    } catch(e) {
        MessageManager.showToast("加载数据失败: " + e, "error");
    }
}
```

## ⚠️ 注意事项

### 1. 编辑功能
编辑功能目前显示"编辑功能开发中"，后续可以实现：
- 加载现有数据到表单
- 修改后更新数据库
- 返回列表页面

### 2. 数据格式
数据内容以 JSON 字符串形式存储在 data 字段中，格式如：
```json
{
    "name": "张三",
    "age": 25,
    "email": "zhangsan@example.com"
}
```

### 3. 时间格式
createTime 字段应该是标准的日期时间格式，如：
```
2024-01-15 14:30:00
```

## 🚀 下一步开发

### 可选功能
1. **编辑记录** - 实现记录编辑功能
2. **搜索过滤** - 添加搜索和筛选功能
3. **分页** - 当记录很多时添加分页
4. **排序** - 支持按时间、ID等排序
5. **批量操作** - 支持批量删除等操作
6. **导出数据** - 导出为Excel或CSV

## 总结

数据记录查询功能已完成：
1. ✅ 输入框边框更清晰
2. ✅ 查询指定表单的所有记录
3. ✅ 显示记录详情
4. ✅ 删除记录（有确认）
5. ✅ 新增记录
6. ✅ 美观的界面设计
7. ✅ 完善的交互反馈

**重新编译项目后即可使用！** 🎉
