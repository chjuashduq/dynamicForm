# QML å®Œå…¨å­¦ä¹ æ•™ç¨‹ - ç¬¬3ç« ï¼šä¿¡å·ä¸æ§½æœºåˆ¶

## ğŸ“š ç›®å½•
1. [ä¿¡å·åŸºç¡€](#ä¿¡å·åŸºç¡€)
2. [ä¿¡å·å¤„ç†å™¨](#ä¿¡å·å¤„ç†å™¨)
3. [è‡ªå®šä¹‰ä¿¡å·](#è‡ªå®šä¹‰ä¿¡å·)
4. [Connections å¯¹è±¡](#connections-å¯¹è±¡)
5. [å®æˆ˜æ¡ˆä¾‹](#å®æˆ˜æ¡ˆä¾‹)

---

## ä¿¡å·åŸºç¡€

### ä»€ä¹ˆæ˜¯ä¿¡å·?

**ä¿¡å· (Signal)** æ˜¯ QML ä¸­çš„äº‹ä»¶é€šçŸ¥æœºåˆ¶ã€‚å½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶,å¯¹è±¡ä¼šå‘å‡ºä¿¡å·ã€‚

**å¸¸è§ä¿¡å·:**
- `onClicked` - ç‚¹å‡»äº‹ä»¶
- `onPressed` - æŒ‰ä¸‹äº‹ä»¶
- `onReleased` - é‡Šæ”¾äº‹ä»¶
- `onTextChanged` - æ–‡æœ¬æ”¹å˜
- `onValueChanged` - å€¼æ”¹å˜

### åŸºæœ¬ç”¨æ³•

```qml
import QtQuick 6.5
import QtQuick.Controls 6.5

Button {
    text: "ç‚¹å‡»æˆ‘"
    
    // ä¿¡å·å¤„ç†å™¨
    onClicked: {
        console.log("æŒ‰é’®è¢«ç‚¹å‡»äº†!")
    }
}
```

---

## ä¿¡å·å¤„ç†å™¨

### 1. å†…è”å¤„ç†

æœ€ç®€å•çš„æ–¹å¼,ç›´æ¥åœ¨ä¿¡å·å¤„ç†å™¨ä¸­å†™ä»£ç ã€‚

```qml
Button {
    text: "è®¡æ•°å™¨"
    property int count: 0
    
    onClicked: {
        count++
        console.log("ç‚¹å‡»æ¬¡æ•°:", count)
    }
}
```

### 2. è°ƒç”¨å‡½æ•°

å°†ä¿¡å·å¤„ç†é€»è¾‘å°è£…åˆ°å‡½æ•°ä¸­ã€‚

```qml
Rectangle {
    width: 200
    height: 200
    color: "lightblue"
    
    MouseArea {
        anchors.fill: parent
        onClicked: handleClick()
    }
    
    function handleClick() {
        console.log("å¤„ç†ç‚¹å‡»äº‹ä»¶")
        parent.color = Qt.rgba(Math.random(), Math.random(), Math.random(), 1)
    }
}
```

### 3. è®¿é—®ä¿¡å·å‚æ•°

æŸäº›ä¿¡å·ä¼šä¼ é€’å‚æ•°ã€‚

```qml
MouseArea {
    anchors.fill: parent
    
    // mouse å‚æ•°åŒ…å«é¼ æ ‡ä¿¡æ¯
    onClicked: function(mouse) {
        console.log("ç‚¹å‡»ä½ç½®:", mouse.x, mouse.y)
        console.log("æŒ‰é”®:", mouse.button)
        console.log("ä¿®é¥°é”®:", mouse.modifiers)
    }
}
```

**å¸¸ç”¨é¼ æ ‡å‚æ•°:**
- `mouse.x, mouse.y` - é¼ æ ‡ä½ç½®
- `mouse.button` - æŒ‰ä¸‹çš„æŒ‰é’® (Qt.LeftButton, Qt.RightButton, Qt.MiddleButton)
- `mouse.modifiers` - ä¿®é¥°é”® (Qt.ShiftModifier, Qt.ControlModifier, Qt.AltModifier)
- `mouse.accepted` - æ˜¯å¦æ¥å—äº‹ä»¶

### 4. å±æ€§å˜åŒ–ä¿¡å·

æ¯ä¸ªå±æ€§éƒ½æœ‰å¯¹åº”çš„å˜åŒ–ä¿¡å·ã€‚

```qml
Rectangle {
    id: box
    width: 100
    height: 100
    color: "red"
    
    // å®½åº¦å˜åŒ–ä¿¡å·
    onWidthChanged: {
        console.log("æ–°å®½åº¦:", width)
    }
    
    // é¢œè‰²å˜åŒ–ä¿¡å·
    onColorChanged: {
        console.log("æ–°é¢œè‰²:", color)
    }
    
    MouseArea {
        anchors.fill: parent
        onClicked: {
            box.width += 10
            box.color = Qt.rgba(Math.random(), Math.random(), Math.random(), 1)
        }
    }
}
```

---

## è‡ªå®šä¹‰ä¿¡å·

### 1. å®šä¹‰ä¿¡å·

ä½¿ç”¨ `signal` å…³é”®å­—å®šä¹‰è‡ªå®šä¹‰ä¿¡å·ã€‚

```qml
Rectangle {
    id: customButton
    width: 100
    height: 40
    color: "lightblue"
    
    // å®šä¹‰è‡ªå®šä¹‰ä¿¡å·
    signal buttonClicked()
    signal buttonPressed(int x, int y)
    signal dataChanged(string message, var data)
    
    Text {
        text: "è‡ªå®šä¹‰æŒ‰é’®"
        anchors.centerIn: parent
    }
    
    MouseArea {
        anchors.fill: parent
        
        onClicked: {
            // å‘å‡ºä¿¡å·
            customButton.buttonClicked()
        }
        
        onPressed: function(mouse) {
            // å‘å‡ºå¸¦å‚æ•°çš„ä¿¡å·
            customButton.buttonPressed(mouse.x, mouse.y)
        }
    }
}
```

### 2. è¿æ¥ä¿¡å·

```qml
Item {
    CustomButton {
        id: myButton
        
        // å¤„ç†è‡ªå®šä¹‰ä¿¡å·
        onButtonClicked: {
            console.log("è‡ªå®šä¹‰æŒ‰é’®è¢«ç‚¹å‡»")
        }
        
        onButtonPressed: function(x, y) {
            console.log("æŒ‰ä¸‹ä½ç½®:", x, y)
        }
    }
}
```

### 3. ä½¿ç”¨ emit å‘å‡ºä¿¡å·

åœ¨ JavaScript å‡½æ•°ä¸­å‘å‡ºä¿¡å·ã€‚

```qml
Rectangle {
    id: counter
    
    signal countChanged(int newCount)
    
    property int count: 0
    
    function increment() {
        count++
        // å‘å‡ºä¿¡å·
        countChanged(count)
    }
    
    function decrement() {
        count--
        countChanged(count)
    }
}
```

---

## Connections å¯¹è±¡

`Connections` ç”¨äºè¿æ¥ä¿¡å·åˆ°å¤„ç†å™¨,ç‰¹åˆ«é€‚åˆåŠ¨æ€è¿æ¥ã€‚

### 1. åŸºæœ¬ç”¨æ³•

```qml
Item {
    Button {
        id: myButton
        text: "ç‚¹å‡»æˆ‘"
    }
    
    // ä½¿ç”¨ Connections è¿æ¥ä¿¡å·
    Connections {
        target: myButton
        
        function onClicked() {
            console.log("é€šè¿‡ Connections å¤„ç†ç‚¹å‡»")
        }
    }
}
```

### 2. åŠ¨æ€ç›®æ ‡

```qml
Item {
    property var currentTarget: button1
    
    Button {
        id: button1
        text: "æŒ‰é’® 1"
    }
    
    Button {
        id: button2
        text: "æŒ‰é’® 2"
        anchors.top: button1.bottom
    }
    
    // åŠ¨æ€åˆ‡æ¢è¿æ¥ç›®æ ‡
    Connections {
        target: currentTarget
        
        function onClicked() {
            console.log("å½“å‰æŒ‰é’®è¢«ç‚¹å‡»:", target.text)
        }
    }
    
    Button {
        text: "åˆ‡æ¢ç›®æ ‡"
        anchors.top: button2.bottom
        onClicked: {
            currentTarget = (currentTarget === button1) ? button2 : button1
        }
    }
}
```

### 3. å¯ç”¨/ç¦ç”¨è¿æ¥

```qml
Item {
    property bool enableLogging: true
    
    Button {
        id: myButton
        text: "ç‚¹å‡»æˆ‘"
    }
    
    Connections {
        target: myButton
        enabled: enableLogging  // æ§åˆ¶æ˜¯å¦å¯ç”¨è¿æ¥
        
        function onClicked() {
            console.log("æŒ‰é’®è¢«ç‚¹å‡»")
        }
    }
    
    CheckBox {
        text: "å¯ç”¨æ—¥å¿—"
        checked: enableLogging
        onCheckedChanged: enableLogging = checked
    }
}
```

---

## å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹ 1: è‡ªå®šä¹‰ç»„ä»¶é€šä¿¡

åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰æŒ‰é’®ç»„ä»¶ `CustomButton.qml`:

```qml
// CustomButton.qml
import QtQuick 6.5

Rectangle {
    id: root
    width: 120
    height: 40
    color: mouseArea.pressed ? "#2980b9" : (mouseArea.containsMouse ? "#3498db" : "#409EFF")
    radius: 4
    
    // æš´éœ²å±æ€§
    property alias text: label.text
    property alias icon: iconText.text
    
    // è‡ªå®šä¹‰ä¿¡å·
    signal clicked()
    signal doubleClicked()
    signal longPressed()
    
    Row {
        anchors.centerIn: parent
        spacing: 8
        
        Text {
            id: iconText
            font.pixelSize: 20
            color: "white"
        }
        
        Text {
            id: label
            font.pixelSize: 14
            color: "white"
        }
    }
    
    MouseArea {
        id: mouseArea
        anchors.fill: parent
        hoverEnabled: true
        
        onClicked: root.clicked()
        onDoubleClicked: root.doubleClicked()
        onPressAndHold: root.longPressed()
    }
    
    // åŠ¨ç”»æ•ˆæœ
    Behavior on color {
        ColorAnimation { duration: 200 }
    }
}
```

ä½¿ç”¨è‡ªå®šä¹‰æŒ‰é’®:

```qml
import QtQuick 6.5
import QtQuick.Controls 6.5

ApplicationWindow {
    width: 400
    height: 300
    visible: true
    title: "è‡ªå®šä¹‰æŒ‰é’®ç¤ºä¾‹"
    
    Column {
        anchors.centerIn: parent
        spacing: 20
        
        CustomButton {
            icon: "ğŸ“"
            text: "ä¿å­˜"
            
            onClicked: {
                console.log("ä¿å­˜æŒ‰é’®è¢«ç‚¹å‡»")
                statusText.text = "æ–‡ä»¶å·²ä¿å­˜"
            }
            
            onDoubleClicked: {
                console.log("åŒå‡»ä¿å­˜")
                statusText.text = "å¿«é€Ÿä¿å­˜"
            }
            
            onLongPressed: {
                console.log("é•¿æŒ‰ä¿å­˜")
                statusText.text = "å¦å­˜ä¸º..."
            }
        }
        
        CustomButton {
            icon: "ğŸ—‘ï¸"
            text: "åˆ é™¤"
            
            onClicked: {
                statusText.text = "å·²åˆ é™¤"
            }
        }
        
        Text {
            id: statusText
            text: "ç­‰å¾…æ“ä½œ..."
            font.pixelSize: 14
            color: "#666"
        }
    }
}
```

### æ¡ˆä¾‹ 2: äº‹ä»¶æ€»çº¿æ¨¡å¼

åˆ›å»ºå…¨å±€äº‹ä»¶ç®¡ç†å™¨ `EventBus.qml`:

```qml
// EventBus.qml
pragma Singleton
import QtQuick 6.5

QtObject {
    id: eventBus
    
    // å®šä¹‰å…¨å±€ä¿¡å·
    signal userLoggedIn(string username)
    signal userLoggedOut()
    signal dataUpdated(var data)
    signal errorOccurred(string message)
    
    // è¾…åŠ©å‡½æ•°
    function login(username) {
        console.log("ç”¨æˆ·ç™»å½•:", username)
        userLoggedIn(username)
    }
    
    function logout() {
        console.log("ç”¨æˆ·ç™»å‡º")
        userLoggedOut()
    }
    
    function updateData(data) {
        console.log("æ•°æ®æ›´æ–°:", JSON.stringify(data))
        dataUpdated(data)
    }
    
    function showError(message) {
        console.log("é”™è¯¯:", message)
        errorOccurred(message)
    }
}
```

åˆ›å»º `qmldir` æ–‡ä»¶:
```
singleton EventBus 1.0 EventBus.qml
```

ä½¿ç”¨äº‹ä»¶æ€»çº¿:

```qml
import QtQuick 6.5
import QtQuick.Controls 6.5
import "." as App

ApplicationWindow {
    width: 600
    height: 400
    visible: true
    title: "äº‹ä»¶æ€»çº¿ç¤ºä¾‹"
    
    // ç›‘å¬å…¨å±€äº‹ä»¶
    Connections {
        target: App.EventBus
        
        function onUserLoggedIn(username) {
            statusBar.text = "æ¬¢è¿, " + username
            loginButton.visible = false
            logoutButton.visible = true
        }
        
        function onUserLoggedOut() {
            statusBar.text = "å·²ç™»å‡º"
            loginButton.visible = true
            logoutButton.visible = false
        }
        
        function onErrorOccurred(message) {
            errorDialog.text = message
            errorDialog.open()
        }
    }
    
    Column {
        anchors.centerIn: parent
        spacing: 20
        
        Button {
            id: loginButton
            text: "ç™»å½•"
            onClicked: {
                App.EventBus.login("å¼ ä¸‰")
            }
        }
        
        Button {
            id: logoutButton
            text: "ç™»å‡º"
            visible: false
            onClicked: {
                App.EventBus.logout()
            }
        }
        
        Button {
            text: "è§¦å‘é”™è¯¯"
            onClicked: {
                App.EventBus.showError("è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é”™è¯¯")
            }
        }
    }
    
    // çŠ¶æ€æ 
    Rectangle {
        id: statusBar
        anchors.bottom: parent.bottom
        width: parent.width
        height: 40
        color: "#f0f0f0"
        
        property alias text: statusText.text
        
        Text {
            id: statusText
            anchors.centerIn: parent
            text: "æœªç™»å½•"
        }
    }
    
    // é”™è¯¯å¯¹è¯æ¡†
    Dialog {
        id: errorDialog
        title: "é”™è¯¯"
        property alias text: errorText.text
        
        Text {
            id: errorText
        }
        
        standardButtons: Dialog.Ok
    }
}
```

### æ¡ˆä¾‹ 3: çˆ¶å­ç»„ä»¶é€šä¿¡

çˆ¶ç»„ä»¶:

```qml
import QtQuick 6.5
import QtQuick.Controls 6.5

ApplicationWindow {
    width: 500
    height: 400
    visible: true
    title: "çˆ¶å­ç»„ä»¶é€šä¿¡"
    
    property int totalScore: 0
    
    Column {
        anchors.fill: parent
        anchors.margins: 20
        spacing: 20
        
        Text {
            text: "æ€»åˆ†: " + totalScore
            font.pixelSize: 24
            font.bold: true
        }
        
        // å­ç»„ä»¶ 1
        ScoreCard {
            title: "æ•°å­¦"
            onScoreChanged: function(score) {
                totalScore += score
            }
        }
        
        // å­ç»„ä»¶ 2
        ScoreCard {
            title: "è‹±è¯­"
            onScoreChanged: function(score) {
                totalScore += score
            }
        }
        
        // å­ç»„ä»¶ 3
        ScoreCard {
            title: "ç‰©ç†"
            onScoreChanged: function(score) {
                totalScore += score
            }
        }
        
        Button {
            text: "é‡ç½®"
            onClicked: totalScore = 0
        }
    }
}
```

å­ç»„ä»¶ `ScoreCard.qml`:

```qml
import QtQuick 6.5
import QtQuick.Controls 6.5

Rectangle {
    width: parent.width
    height: 60
    color: "#f5f5f5"
    radius: 4
    border.color: "#ddd"
    border.width: 1
    
    property string title: "ç§‘ç›®"
    property int score: 0
    
    signal scoreChanged(int delta)
    
    Row {
        anchors.fill: parent
        anchors.margins: 10
        spacing: 20
        
        Text {
            text: title
            font.pixelSize: 16
            anchors.verticalCenter: parent.verticalCenter
            width: 100
        }
        
        Text {
            text: "åˆ†æ•°: " + score
            font.pixelSize: 14
            anchors.verticalCenter: parent.verticalCenter
            width: 100
        }
        
        Button {
            text: "+10"
            onClicked: {
                score += 10
                scoreChanged(10)
            }
        }
        
        Button {
            text: "-10"
            onClicked: {
                score -= 10
                scoreChanged(-10)
            }
        }
    }
}
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¿¡å·å‘½åè§„èŒƒ

```qml
// âœ… å¥½çš„å‘½å
signal itemClicked(int index)
signal dataLoaded(var data)
signal errorOccurred(string message)

// âŒ ä¸å¥½çš„å‘½å
signal click()
signal data()
signal err()
```

### 2. é¿å…ä¿¡å·å¾ªç¯

```qml
// âŒ é”™è¯¯: å¯èƒ½å¯¼è‡´æ— é™å¾ªç¯
Rectangle {
    property int value: 0
    
    onValueChanged: {
        value = value + 1  // å±é™©!
    }
}

// âœ… æ­£ç¡®: ä½¿ç”¨æ¡ä»¶åˆ¤æ–­
Rectangle {
    property int value: 0
    property bool updating: false
    
    onValueChanged: {
        if (!updating) {
            updating = true
            // å¤„ç†é€»è¾‘
            updating = false
        }
    }
}
```

### 3. ä½¿ç”¨å‡½æ•°å°è£…å¤æ‚é€»è¾‘

```qml
// âœ… å¥½çš„åšæ³•
Button {
    onClicked: handleButtonClick()
    
    function handleButtonClick() {
        // å¤æ‚çš„å¤„ç†é€»è¾‘
        validateInput()
        processData()
        updateUI()
    }
}

// âŒ ä¸å¥½çš„åšæ³•
Button {
    onClicked: {
        // å¤§é‡ä»£ç ç›´æ¥å†™åœ¨è¿™é‡Œ...
    }
}
```

---

## ğŸ“ å°ç»“

æœ¬ç« å­¦ä¹ äº†:
- âœ… ä¿¡å·çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•
- âœ… ä¿¡å·å¤„ç†å™¨çš„å¤šç§æ–¹å¼
- âœ… å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨è‡ªå®šä¹‰ä¿¡å·
- âœ… Connections å¯¹è±¡çš„é«˜çº§ç”¨æ³•
- âœ… å®é™…é¡¹ç›®ä¸­çš„ä¿¡å·é€šä¿¡æ¨¡å¼

**ä¸‹ä¸€ç« é¢„å‘Š:** JavaScript é›†æˆ - å­¦ä¹ å¦‚ä½•åœ¨ QML ä¸­ä½¿ç”¨ JavaScript
