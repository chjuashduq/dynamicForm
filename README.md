# 动态表单QML项目

一个基于Qt QML的动态表单生成器，支持可视化配置和实时预览。

## 项目结构

```
├── qml/
│   ├── config/                       # 配置编辑相关组件
│   │   ├── ConfigEditor.qml          # 配置编辑器主组件 (完整功能版)
│   │   └── ControlConfigItem.qml     # 控件配置项组件
│   ├── render/                       # 表单渲染相关组件
│   │   ├── FormPreview.qml           # 表单预览组件
│   │   └── ControlFactory.qml        # 控件工厂组件
│   └── core/                         # 核心功能组件
│       ├── ScriptEngine.qml          # 脚本引擎
│       └── FormAPI.qml               # 表单API接口
├── form_config.json                  # 默认表单配置
├── example_config.json               # 示例配置文件
└── README.md                         # 项目说明文档
```

## 核心组件说明

### 核心组件

#### ConfigEditor.qml
**配置编辑器主组件**
- 提供可视化的表单配置界面
- 支持网格布局设置（行数、列数、间距）
- 支持多种控件类型的添加和配置
- 实时位置验证和冲突检测
- 网格式控件预览和管理
- 智能函数提示和代码插入

#### ControlFactory.qml
**控件工厂组件**
- 根据JSON配置动态创建表单控件
- 支持统一的控件创建接口
- 处理控件样式、事件和数据绑定

**支持的控件类型：**
- 📝 text: 文本输入框
- 🔢 number: 数字输入框
- 🔒 password: 密码输入框
- 📋 dropdown: 下拉选择框
- ☑️ checkbox: 复选框组
- 🔘 radio: 单选框组
- 🎯 button: 按钮

#### FormPreview.qml
**表单预览组件**
- 实时渲染表单界面
- 支持网格布局和响应式设计
- 提供数据收集和表单验证功能

## 重要更新 (v2.0)

### 1. 修复rowHeights和columnWidths功能
- ✅ 添加了行高列宽配置界面
- ✅ 支持逗号分隔的比例输入
- ✅ 实时验证和自动补全
- ✅ 与网格预览完全同步

### 2. 模块化重构
- ✅ 创建了可复用的模块化组件
- ✅ 保留完整功能的主编辑器
- ✅ 清晰的职责分离和接口定义
- ✅ 为未来重构奠定基础

### 3. 代码优化
- ✅ 移除所有console.log调试输出
- ✅ 添加详细的JSDoc风格注释
- ✅ 优化性能和内存使用
- ✅ 统一的错误处理机制

### 4. 用户体验改进
- ✅ 更直观的网格配置界面
- ✅ 实时的配置预览和验证
- ✅ 更好的视觉反馈和交互
- ✅ 响应式布局适配

## 配置文件格式

### 网格配置
```json
{
  \"grid\": {
    \"rows\": 6,                    // 网格行数
    \"columns\": 2,                 // 网格列数
    \"rowHeights\": [1,1,1,1,1,1],  // 行高比例 (新增)
    \"columnWidths\": [1,1],        // 列宽比例 (新增)
    \"rowSpacing\": 5,              // 行间距
    \"columnSpacing\": 10           // 列间距
  }
}
```

### 控件配置
```json
{
  \"controls\": [
    {
      \"type\": \"text\",           // 控件类型
      \"key\": \"username\",        // 唯一标识
      \"label\": \"用户名\",        // 显示标签
      \"placeholder\": \"请输入用户名\", // 占位符
      \"value\": \"\",             // 默认值
      \"row\": 0,                // 起始行
      \"column\": 0,             // 起始列
      \"rowSpan\": 1,            // 行跨度
      \"colSpan\": 1,            // 列跨度
      \"labelRatio\": 0.3,       // 标签宽度比例
      \"events\": {              // 事件配置
        \"onFocusLost\": \"validateRequired(value, '用户名不能为空')\",
        \"onTextChanged\": \"// 文本变化处理\"
      }
    }
  ]
}
```

## 使用方法

### 主配置编辑器
1. 使用 `ConfigEditor.qml` 作为主编辑器
2. 模块化架构，代码清晰易维护
3. 完整的控件编辑功能
4. 智能函数提示和事件配置
5. 优化的用户界面和交互体验

### 操作流程 (完整版)
1. **网格配置** - 设置表单的行列数、间距和行高列宽比例
2. **添加控件** - 使用控件按钮添加所需控件类型
3. **网格预览** - 在预览区域查看控件布局和位置
4. **编辑控件** - 双击控件或点击"编辑"按钮进行详细配置
5. **属性设置** - 配置控件标识、标签、位置、跨度等属性
6. **选项配置** - 为下拉框、复选框、单选框设置选项
7. **事件配置** - 配置焦点丢失和变化事件，使用智能函数提示
8. **位置验证** - 系统自动检测位置冲突并提示
9. **应用配置** - 配置自动应用到表单预览
10. **导出配置** - 查看和导出完整的JSON配置

### 当前功能状态 (完整版)
- ✅ **网格配置** - 完整的行列数、间距、行高列宽比例配置
- ✅ **控件添加** - 支持7种控件类型的添加
- ✅ **网格预览** - 实时显示网格布局和控件位置
- ✅ **控件编辑** - 完整的控件属性编辑对话框
- ✅ **事件配置** - 焦点丢失和变化事件配置
- ✅ **智能提示** - 函数帮助对话框和代码插入
- ✅ **位置验证** - 实时位置冲突检测
- ✅ **选项配置** - 下拉框、复选框、单选框选项设置
- ✅ **配置导出** - JSON配置查看和导出
- ✅ **实时同步** - 配置编辑器与表单预览实时同步

### 组件架构
- `ConfigEditor.qml` - 主配置编辑器 (完整功能，包含所有特性)
- `ControlConfigItem.qml` - 控件配置项组件

## 开发说明

### 性能优化
- 使用延迟更新机制避免频繁刷新
- 批量处理界面更新操作
- 智能的属性绑定和模型更新
- 组件级别的状态管理

### 代码质量
- 详细的JSDoc风格注释
- 统一的错误处理和日志输出
- 模块化设计，职责分离
- 完整的类型定义和接口规范

### 扩展性
- 易于添加新的控件类型
- 灵活的事件系统
- 可配置的样式和布局
- 插件化的组件架构

## 版本信息

- **版本**: 2.0
- **作者**: Dynamic Form QML Team
- **Qt版本**: 6.5+
- **许可证**: MIT

## 更新日志

### v2.0 (当前版本)
- ✅ 恢复到完整功能的原始版本
- ✅ 修复rowHeights和columnWidths功能
- ✅ 完整的控件编辑对话框
- ✅ 智能函数提示和事件配置
- ✅ 实时位置验证和冲突检测
- ✅ 完整的选项配置支持
- ✅ 清理所有console输出
- ✅ 添加详细注释和文档
- ✅ 修复语法错误，确保正常运行

### v1.0
- ✅ 基础表单配置功能
- ✅ 多种控件类型支持
- ✅ 网格布局系统
- ✅ 事件配置系统