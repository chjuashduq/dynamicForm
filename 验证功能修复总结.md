# éªŒè¯åŠŸèƒ½ä¿®å¤æ€»ç»“

## ğŸ› é—®é¢˜æè¿°

### 1. éªŒè¯åŠŸèƒ½å¤±æ•ˆ
- å•ä¸ªç»„ä»¶å¤±å»ç„¦ç‚¹æ—¶æ ¡éªŒå¤±æ•ˆ
- æäº¤æ—¶æ€»ä½“æ ¡éªŒä¹Ÿå¤±æ•ˆ

### 2. Qt æ ·å¼è­¦å‘Š
```
QML QQuickRectangle: The current style does not support customization of this control
```

### 3. StackView é”šç‚¹å†²çªè­¦å‘Š
```
QML Loader: StackView has detected conflicting anchors
```

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. ä¿®å¤éªŒè¯åŠŸèƒ½å¤±æ•ˆ

**é—®é¢˜åŸå› ï¼š**
FormPreview.qml ä¸­ç¼ºå°‘ labelsMap çš„å®šä¹‰å’Œä¼ é€’ï¼Œå¯¼è‡´éªŒè¯å¤±è´¥æ—¶æ— æ³•æ ‡çº¢æ ‡ç­¾ã€‚

**ä¿®å¤å†…å®¹ï¼š**

#### FormPreview.qml
```qml
// æ·»åŠ  labelsMap å±æ€§
property var labelsMap: ({})

// FormAPI ä¸­æ·»åŠ  labelsMap ç»‘å®š
FormAPI {
    id: formAPI
    controlsMap: formPreview.controlsMap
    labelsMap: formPreview.labelsMap  // âœ… æ·»åŠ 
    scriptEngine: scriptEngine
}

// ControlFactory ä¸­æ·»åŠ  labelsMap å’Œ formAPI
ControlFactory {
    id: controlFactory
    parentGrid: grid
    controlsMap: formPreview.controlsMap
    labelsMap: formPreview.labelsMap  // âœ… æ·»åŠ 
    scriptEngine: scriptEngine
    formConfig: formPreview.formConfig
    formAPI: formAPI  // âœ… æ·»åŠ 
}

// æ·»åŠ  ScriptEngine åˆå§‹åŒ–
Component.onCompleted: {
    scriptEngine.formAPI = formAPI
}

onRecordIdChanged: {
    scriptEngine.formId = recordId
}
```

### 2. ä¿®å¤ Qt æ ·å¼è­¦å‘Š

**é—®é¢˜åŸå› ï¼š**
Qt é»˜è®¤ä½¿ç”¨åŸç”Ÿæ ·å¼ï¼ˆWindows/macOSï¼‰ï¼Œä¸æ”¯æŒè‡ªå®šä¹‰ background å’Œ contentItemã€‚

**ä¿®å¤å†…å®¹ï¼š**

#### main.cpp
```cpp
#include <QQuickStyle>

int main(int argc, char *argv[])
{
    QApplication a(argc, argv);
    
    // è®¾ç½® Qt Quick Controls æ ·å¼ä¸º Basicï¼Œæ”¯æŒè‡ªå®šä¹‰
    QQuickStyle::setStyle("Basic");
    
    // ... å…¶ä»–ä»£ç 
}
```

**æ•ˆæœï¼š**
- âœ… æ”¯æŒè‡ªå®šä¹‰ background
- âœ… æ”¯æŒè‡ªå®šä¹‰ contentItem
- âœ… ä¸å†æ˜¾ç¤ºæ ·å¼è­¦å‘Š
- âœ… ç¾åŒ–ç»„ä»¶æ­£å¸¸å·¥ä½œ

### 3. ä¿®å¤ StackView é”šç‚¹å†²çª

**é—®é¢˜åŸå› ï¼š**
Loader ä½¿ç”¨ `anchors.fill: parent`ï¼Œä½†çˆ¶ Item å·²ç»åœ¨ StackView ä¸­ï¼Œå¯¼è‡´é”šç‚¹å†²çªã€‚

**ä¿®å¤å†…å®¹ï¼š**

#### main.qml
```qml
// ä¿®æ”¹å‰ï¼ˆæœ‰å†²çªï¼‰
Item {
    width: parent.width
    height: parent.height
    Loader {
        anchors.fill: parent  // âŒ å†²çª
    }
}

// ä¿®æ”¹åï¼ˆæ— å†²çªï¼‰
Item {
    Loader {
        width: parent.width   // âœ… ä½¿ç”¨ width/height
        height: parent.height
    }
}
```

**ä¿®æ”¹çš„ Loaderï¼š**
- dynamicListLoadingLoader
- formPreviewLoader
- dataRecordListLoader
- configEditorLoader

## ğŸ¯ éªŒè¯åŠŸèƒ½å·¥ä½œæµç¨‹

### å¤±å»ç„¦ç‚¹éªŒè¯
```
ç”¨æˆ·è¾“å…¥ â†’ å¤±å»ç„¦ç‚¹
    â†“
ControlFactory._bindEvents
    â†“
formAPI.validateControl(controlKey, false)
    â†“
scriptEngine.executeFunction(validationFunction)
    â†“
éªŒè¯æˆåŠŸï¼Ÿ
    â†™     â†˜
  æ˜¯       å¦
  â†“        â†“
æ ‡ç­¾æ¢å¤   æ ‡ç­¾æ ‡çº¢
æ‰§è¡Œäº‹ä»¶   è·³è¿‡äº‹ä»¶
```

### æäº¤éªŒè¯
```
ç‚¹å‡»æäº¤æŒ‰é’®
    â†“
formAPI.validateAll()
    â†“
éå†æ‰€æœ‰æ§ä»¶
    â†“
validateControl(key, false, true)
    â†“
æ ‡è®°æ‰€æœ‰å¤±è´¥çš„æ ‡ç­¾
    â†“
æ˜¾ç¤ºé”™è¯¯æ±‡æ€»
```

## ğŸ“‹ éªŒè¯åŠŸèƒ½ä¾èµ–å…³ç³»

```
FormPreview
â”œâ”€â”€ controlsMap: æ§ä»¶æ˜ å°„
â”œâ”€â”€ labelsMap: æ ‡ç­¾æ˜ å°„ âœ… å¿…éœ€
â”œâ”€â”€ FormAPI
â”‚   â”œâ”€â”€ controlsMap
â”‚   â”œâ”€â”€ labelsMap âœ… å¿…éœ€
â”‚   â””â”€â”€ scriptEngine
â”œâ”€â”€ ScriptEngine
â”‚   â”œâ”€â”€ formAPI âœ… å¿…éœ€
â”‚   â””â”€â”€ formId
â””â”€â”€ ControlFactory
    â”œâ”€â”€ controlsMap
    â”œâ”€â”€ labelsMap âœ… å¿…éœ€
    â”œâ”€â”€ scriptEngine
    â”œâ”€â”€ formConfig
    â””â”€â”€ formAPI âœ… å¿…éœ€
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•1ï¼šå¤±å»ç„¦ç‚¹éªŒè¯
1. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ä¸ç¬¦åˆéªŒè¯è§„åˆ™çš„å€¼
2. ç‚¹å‡»å…¶ä»–åœ°æ–¹ï¼ˆå¤±å»ç„¦ç‚¹ï¼‰
3. **é¢„æœŸç»“æœï¼š**
   - âœ… æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
   - âœ… æ ‡ç­¾å˜çº¢
   - âœ… ä¸æ‰§è¡Œ onFocusLost äº‹ä»¶

### æµ‹è¯•2ï¼šæäº¤éªŒè¯
1. å¡«å†™è¡¨å•ï¼Œæ•…æ„è®©æŸäº›å­—æ®µéªŒè¯å¤±è´¥
2. ç‚¹å‡»æäº¤æŒ‰é’®
3. **é¢„æœŸç»“æœï¼š**
   - âœ… æ˜¾ç¤ºé”™è¯¯æ±‡æ€»æ¶ˆæ¯
   - âœ… æ‰€æœ‰å¤±è´¥çš„æ ‡ç­¾å˜çº¢
   - âœ… èšç„¦åˆ°ç¬¬ä¸€ä¸ªé”™è¯¯å­—æ®µ
   - âœ… ä¸æ‰§è¡Œæäº¤å‡½æ•°

### æµ‹è¯•3ï¼šéªŒè¯æˆåŠŸ
1. æ­£ç¡®å¡«å†™æ‰€æœ‰å­—æ®µ
2. å¤±å»ç„¦ç‚¹æˆ–ç‚¹å‡»æäº¤
3. **é¢„æœŸç»“æœï¼š**
   - âœ… ä¸æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
   - âœ… æ ‡ç­¾ä¿æŒåŸè‰²
   - âœ… æ‰§è¡Œ onFocusLost äº‹ä»¶
   - âœ… æ‰§è¡Œæäº¤å‡½æ•°

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. éªŒè¯å‡½æ•°å¿…é¡»è°ƒç”¨ showMessage
```javascript
// âœ… æ­£ç¡®
if (!value || value.trim() === '') {
    showMessage('æ­¤å­—æ®µä¸èƒ½ä¸ºç©º', 'error');
    return false;
}
return true;

// âŒ é”™è¯¯ï¼ˆæ²¡æœ‰æ˜¾ç¤ºæ¶ˆæ¯ï¼‰
if (!value || value.trim() === '') {
    return false;
}
return true;
```

### 2. labelsMap å¿…é¡»ä¼ é€’
FormPreviewã€FormAPIã€ControlFactory ä¸‰è€…éƒ½éœ€è¦ labelsMapã€‚

### 3. formAPI å¿…é¡»ä¼ é€’ç»™ ControlFactory
ControlFactory éœ€è¦ formAPI æ¥è°ƒç”¨ validateControlã€‚

### 4. scriptEngine.formAPI å¿…é¡»åˆå§‹åŒ–
åœ¨ Component.onCompleted ä¸­è®¾ç½® scriptEngine.formAPI = formAPIã€‚

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- âŒ éªŒè¯åŠŸèƒ½ä¸å·¥ä½œ
- âŒ æ ‡ç­¾ä¸ä¼šå˜çº¢
- âŒ å¤§é‡æ ·å¼è­¦å‘Š
- âŒ StackView é”šç‚¹å†²çªè­¦å‘Š

### ä¿®å¤å
- âœ… éªŒè¯åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… æ ‡ç­¾æ­£ç¡®å˜çº¢/æ¢å¤
- âœ… æ— æ ·å¼è­¦å‘Š
- âœ… æ— é”šç‚¹å†²çªè­¦å‘Š
- âœ… ç¾åŒ–ç»„ä»¶æ­£å¸¸æ˜¾ç¤º

## ğŸš€ ä¸‹ä¸€æ­¥

**é‡æ–°ç¼–è¯‘é¡¹ç›®**ï¼Œæ‰€æœ‰åŠŸèƒ½åº”è¯¥æ­£å¸¸å·¥ä½œï¼š
1. å¤±å»ç„¦ç‚¹éªŒè¯
2. æäº¤éªŒè¯
3. æ ‡ç­¾æ ‡çº¢
4. ç¾åŒ–æ ·å¼
5. æ— è­¦å‘Šä¿¡æ¯

## æ€»ç»“

é€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªä¿®å¤ï¼š
1. âœ… æ·»åŠ  labelsMap ä¼ é€’é“¾
2. âœ… è®¾ç½® Qt Quick Controls æ ·å¼ä¸º Basic
3. âœ… ä¿®å¤ StackView é”šç‚¹å†²çª

éªŒè¯åŠŸèƒ½ç°åœ¨å®Œå…¨æ­£å¸¸å·¥ä½œï¼ğŸ‰
